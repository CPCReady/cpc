#!/bin/bash
# ConfiguraciÃ³n de entorno para el proyecto CPCReady Toolchain
# Este archivo se carga automÃ¡ticamente con direnv

# Definir variables de entorno del proyecto
export CPCREADY="PROJECT"
export CPCREADY_DIR="$PWD"
export CPCREADY_LIB="$PWD/lib/cpc-common.sh"

# Crear un directorio temporal para el wrapper de brew si no existe
mkdir -p "$PWD/.direnv/bin"

# Crear el wrapper de brew
cat > "$PWD/.direnv/bin/brew" << 'EOF'
#!/bin/bash
if [[ "$1" == "--prefix" ]]; then
    echo "$CPCREADY_DIR"
else
    # Buscar el brew real en el sistema
    if [[ -x "/opt/homebrew/bin/brew" ]]; then
        /opt/homebrew/bin/brew "$@"
    elif [[ -x "/usr/local/bin/brew" ]]; then
        /usr/local/bin/brew "$@"
    else
        echo "Error: brew not found" >&2
        exit 1
    fi
fi
EOF

chmod +x "$PWD/.direnv/bin/brew"

# AÃ±adir el directorio .direnv/bin al principio del PATH
export PATH="$PWD/.direnv/bin:$PWD/bin:$PATH"

# Mostrar mensaje informativo
echo ""
echo "ðŸš€ CPCReady Toolchain environment loaded!"
echo "   âœ“ bin/ added to PATH"
echo "   âœ“ CPCREADY_DIR: $CPCREADY_DIR"
echo "   âœ“ Command 'cpc' is now available"
echo "   âœ“ brew --prefix overridden to return workspace path"
echo ""